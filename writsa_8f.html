<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>NCEPLIBS-bufr: writsa.f File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">NCEPLIBS-bufr
   &#160;<span id="projectnumber">11.6.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('writsa_8f.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">writsa.f File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Write a data subset into a BUFR message, and return each completed message within a memory array.  
<a href="#details">More...</a></p>

<p><a href="writsa_8f_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a50e3c630fd99f545e2427fe9b18c4d48"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="writsa_8f.html#a50e3c630fd99f545e2427fe9b18c4d48">writsa</a> (LUNXX, LMSGT, MSGT, MSGL)</td></tr>
<tr class="memdesc:a50e3c630fd99f545e2427fe9b18c4d48"><td class="mdescLeft">&#160;</td><td class="mdescRight">This subroutine is similar to subroutine <a class="el" href="writsb_8f.html#a02b3dbd97116388430f863f3e49fa47f" title="This subroutine writes a complete data subset into a BUFR message, for eventual output to logical uni...">writsb()</a>, except that in addition to writing each completed message to a specified Fortran logical unit, it also returns a copy of each completed message to the application program within a memory array.  <a href="#a50e3c630fd99f545e2427fe9b18c4d48">More...</a><br/></td></tr>
<tr class="separator:a50e3c630fd99f545e2427fe9b18c4d48"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Write a data subset into a BUFR message, and return each completed message within a memory array. </p>

<p>Definition in file <a class="el" href="writsa_8f_source.html">writsa.f</a>.</p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a class="anchor" id="a50e3c630fd99f545e2427fe9b18c4d48"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine writsa </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>LUNXX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>LMSGT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">dimension(*)&#160;</td>
          <td class="paramname"><em>MSGT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>MSGL</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This subroutine is similar to subroutine <a class="el" href="writsb_8f.html#a02b3dbd97116388430f863f3e49fa47f" title="This subroutine writes a complete data subset into a BUFR message, for eventual output to logical uni...">writsb()</a>, except that in addition to writing each completed message to a specified Fortran logical unit, it also returns a copy of each completed message to the application program within a memory array. </p>
<dl class="section author"><dt>Authors</dt><dd>J. Woollen </dd>
<dd>
J. Ator </dd></dl>
<dl class="section date"><dt>Date</dt><dd>1994-01-06</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">LUNXX</td><td>&ndash; integer: Absolute value is Fortran logical unit number for BUFR file </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">LMSGT</td><td>&ndash; integer: Dimensioned size (in integers) of MSGT; used by the subroutine to ensure that it doesn't overflow the MSGT array </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">MSGT</td><td>&ndash; integer(*): BUFR message </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">MSGL</td><td>&ndash; integer: Size (in integers) of BUFR message in MSGT<ul>
<li>0 = No BUFR message was returned within MSGT</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<p>This subroutine looks and behaves a lot like subroutine <a class="el" href="writsb_8f.html#a02b3dbd97116388430f863f3e49fa47f" title="This subroutine writes a complete data subset into a BUFR message, for eventual output to logical uni...">writsb()</a>. Specifically, it is called to indicate to the BUFRLIB software that all necessary values for a data subset (i.e. report) have been written, and thus that the subset is ready to be encoded and packed into the current message for the BUFR file associated with logical unit ABS(LUNXX). Logical unit ABS(LUNXX) should have already been opened for output operations via a previous call to subroutine <a class="el" href="openbf_8f.html#a9bea9aeada166bd9037b959ca8452b28" title="This subroutine connects a new file to the BUFRLIB software for input or output operations. ">openbf()</a>, and a BUFR message should already be open for output within internal arrays via a previous call to one of the BUFRLIB <a class="el" href="md__gpfs_dell2_emc_obsproc_noscrub_Jeff_8Ator_NCEPLIBS-bufr-GitHub_nceplibs-bufr_docs_UserGuide.html#hierarchy">message-writing subroutines</a>. Furthermore, all of the values for the data subset should have already been written into internal arrays via calls to any of the BUFRLIB <a class="el" href="md__gpfs_dell2_emc_obsproc_noscrub_Jeff_8Ator_NCEPLIBS-bufr-GitHub_nceplibs-bufr_docs_UserGuide.html#hierarchy">values-writing subroutines</a></p>
<p>Where this subroutine differs from <a class="el" href="writsb_8f.html#a02b3dbd97116388430f863f3e49fa47f" title="This subroutine writes a complete data subset into a BUFR message, for eventual output to logical uni...">writsb()</a> is that, in addition to doing all of the above, it also returns a copy of each completed BUFR message to the application program within a memory array. When using this subroutine, it is important to note that the BUFRLIB software is designed to pack as many data subsets as possible into each message for output, and therefore not every call to this subroutine will result in a message being returned in MSGT. In such cases, MSGL will contain the value 0, indicating that no message was returned.</p>
<p>In other words, only when MSGL contains a value greater than 0 is there an actual BUFR message within MSGT; otherwise, the message into which the data subset was packed remains internally within BUFRLIB so that future data subsets can be packed into it as well, and the message will eventually be returned during some other future call to this subroutine. For this reason, there is a way to force the subroutine to return any message contained within the internal BUFRLIB arrays, such as when there are no more data subsets to be encoded and we're ready to exit the application program. In this case, the application program should make one final call to this subroutine, but with LUNXX set to a negative value; specifically, to the additive inverse of the Fortran logical unit number of the BUFR file. This signals to the subroutine that there are no more data subsets to be packed into the current message for logical unit ABS(LUNXX), and that the existing message should instead be immediately flushed to output and returned in MSGT.</p>
<dl class="section remark"><dt>Remarks</dt><dd><ul>
<li>There is a maximum size for any BUFR message that can be written by the BUFRLIB software. This maximum message size is initially set to an internal default value within subroutine <a class="el" href="bfrini_8f90.html#ab3f045cc170403305543e34e30b87001" title="This subroutine initializes numerous global variables and arrays within internal modules and COMMON b...">bfrini()</a>, but it can be changed to a different value via a separate prior call to subroutine <a class="el" href="maxout_8f.html#a453cb7f1f1dda1ab39e54b7a09b9b801" title="This subroutine allows the user to define the maximum length of a BUFR message that can be written to...">maxout()</a>.</li>
<li>As is the case for subroutine <a class="el" href="writsb_8f.html#a02b3dbd97116388430f863f3e49fa47f" title="This subroutine writes a complete data subset into a BUFR message, for eventual output to logical uni...">writsb()</a>, this subroutine will also check to ensure that the data subset, when encoded and packed, will fit into the current BUFR message that is open within the internal arrays associated with logical unit ABS(LUNXX). If adding the data subset to the current message would cause the maximum message size to be exceeded, then the subroutine will automatically flush the current message to logical unit ABS(LUNXX) and to array MSGT, then open and initialize a new internal message using the same SUBSET and JDATE values that were specified in the most recent call to one of the <a class="el" href="md__gpfs_dell2_emc_obsproc_noscrub_Jeff_8Ator_NCEPLIBS-bufr-GitHub_nceplibs-bufr_docs_UserGuide.html#hierarchy">message-writing subroutines</a> for ABS(LUNXX), then encode and pack the data subset into that new message.</li>
<li>If the user would prefer that output messages only be returned to the calling program via the MSGT memory array and not also written to Fortran logical unit ABS(LUNXX), then this can be accomplished by setting IO = 'NUL' when calling subroutine <a class="el" href="openbf_8f.html#a9bea9aeada166bd9037b959ca8452b28" title="This subroutine connects a new file to the BUFRLIB software for input or output operations. ">openbf()</a> for ABS(LUNXX). In such cases, the logical unit number ABS(LUNXX) does not even need to be associated with an actual file on the local system.</li>
</ul>
</dd></dl>
<p><b>Program history log:</b> </p>
<table class="doxtable">
<tr>
<th>Date </th><th>Programmer </th><th>Comments  </th></tr>
<tr>
<td>1994-01-06 </td><td>J. Woollen </td><td>Original author </td></tr>
<tr>
<td>1998-07-08 </td><td>J. Woollen </td><td>Replaced call to Cray library routine "ABORT" with call to new internal routine <a class="el" href="bort_8f.html#a488d3a8cf930fb592a9fdaefcfa04ac4" title="This subroutine calls subroutine errwrt() to log an error message, then calls subroutine bort_exit() ...">bort()</a>; modified to make Y2K compliant </td></tr>
<tr>
<td>2000-09-19 </td><td>J. Woollen </td><td>Maximum message length increased from 10,000 to 20,000 bytes </td></tr>
<tr>
<td>2003-11-04 </td><td>S. Bender </td><td>Added remarks and routine interdependencies </td></tr>
<tr>
<td>2003-11-04 </td><td>D. Keyser </td><td>Unified/portable for WRF; added documentation; outputs more complete diagnostic info when routine terminates abnormally </td></tr>
<tr>
<td>2004-08-18 </td><td>J. Ator </td><td>Add post <a class="el" href="msgupd_8f.html#adf75cb2bc2a217eb33ffc8e45b1a5350" title="THIS SUBROUTINE PACKS UP THE CURRENT SUBSET WITHIN MEMORY (ARRAY IBAY IN MODULE BITBUF) AND THEN TRIE...">msgupd()</a> check for and return of message within MSGT in order to prevent loss of message in certain situations; maximum message length increased from 20,000 to 50,000 bytes </td></tr>
<tr>
<td>2005-03-09 </td><td>J. Ator </td><td>Added capability for compressed messages </td></tr>
<tr>
<td>2009-03-23 </td><td>J. Ator </td><td>Added LMSGT argument and check </td></tr>
<tr>
<td>2014-12-10 </td><td>J. Ator </td><td>Use modules instead of COMMON blocks </td></tr>
<tr>
<td>2019-05-09 </td><td>J. Ator </td><td>Added dimensions for MSGLEN and MSGTXT </td></tr>
<tr>
<td>2020-09-22 </td><td>J. Ator </td><td>Added capability to return two BUFR messages within MSGT during the same call to this routine, in the rare instances where this can occur </td></tr>
</table>

<p>Definition at line <a class="el" href="writsa_8f_source.html#l00106">106</a> of file <a class="el" href="writsa_8f_source.html">writsa.f</a>.</p>

<p>References <a class="el" href="bort_8f.html#a488d3a8cf930fb592a9fdaefcfa04ac4">bort()</a>, <a class="el" href="closmg_8f.html#a3378111de0136710daec2ded25ed34e4">closmg()</a>, <a class="el" href="msgupd_8f.html#adf75cb2bc2a217eb33ffc8e45b1a5350">msgupd()</a>, <a class="el" href="status_8f.html#a22292e7a69c411a961168198d259f336">status()</a>, <a class="el" href="wrcmps_8f.html#a8b333832f77606059ec94ba8b80d4e8d">wrcmps()</a>, and <a class="el" href="wrtree_8f.html#a0700f04d89a10a24b1acb184f6022c77">wrtree()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_30c37837910170b6dae887e9df3b66a9.html">nceplibs-bufr</a></li><li class="navelem"><a class="el" href="dir_e81fc8df062d10d5f2b231f7e4ab81b8.html">src</a></li><li class="navelem"><a class="el" href="writsa_8f.html">writsa.f</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
